# 4. UDP ì†Œì¼“ í”„ë¡œê·¸ë˜ë°

## 4.1 UDP ì„œë²„/í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„

### ğŸ“Œ UDPì˜ íŠ¹ì§• ìš”ì•½

| í•­ëª©      | ì„¤ëª…                                  |
| --------- | ------------------------------------- |
| ì „ì†¡ ë°©ì‹ | ë¹„ì—°ê²°í˜•, ë‹¨ë°©í–¥ ë©”ì‹œì§€               |
| ì‹ ë¢°ì„±    | ì—†ìŒ (ì†ì‹¤ ê°€ëŠ¥, ìˆœì„œ ë’¤ë°”ë€” ìˆ˜ ìˆìŒ) |
| í—¤ë” í¬ê¸° | ì‘ìŒ (8ë°”ì´íŠ¸)                        |
| ì†ë„      | ë¹ ë¦„, ì§€ì—° ì‹œê°„ ì‘ìŒ                  |
| ì‚¬ìš© ì‚¬ë¡€ | DNS, ìŠ¤íŠ¸ë¦¬ë°, VoIP ë“±                |

------

### âœ… 1. UDP ì„œë²„ êµ¬ì¡°

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <arpa/inet.h>

#define PORT 8888
#define BUF_SIZE 1024

int main() {
    int sock;
    struct sockaddr_in server_addr, client_addr;
    socklen_t client_len = sizeof(client_addr);
    char buffer[BUF_SIZE];

    // 1. ì†Œì¼“ ìƒì„±
    sock = socket(AF_INET, SOCK_DGRAM, 0);

    // 2. ì£¼ì†Œ ì„¤ì •
    memset(&server_addr, 0, sizeof(server_addr));
    server_addr.sin_family = AF_INET;
    server_addr.sin_addr.s_addr = INADDR_ANY;
    server_addr.sin_port = htons(PORT);

    // 3. ë°”ì¸ë”©
    bind(sock, (struct sockaddr*)&server_addr, sizeof(server_addr));

    printf("UDP ì„œë²„ ì‹¤í–‰ ì¤‘ (í¬íŠ¸ %d)...\n", PORT);

    // 4. ë°ì´í„° ìˆ˜ì‹  ë° ì‘ë‹µ
    while (1) {
        int n = recvfrom(sock, buffer, BUF_SIZE, 0,
                         (struct sockaddr*)&client_addr, &client_len);
        buffer[n] = '\0';

        printf("ë°›ì€ ë©”ì‹œì§€: %s\n", buffer);
        sendto(sock, buffer, strlen(buffer), 0,
               (struct sockaddr*)&client_addr, client_len);
    }

    close(sock);
    return 0;
}
```

------

### âœ… 2. UDP í´ë¼ì´ì–¸íŠ¸ êµ¬ì¡°

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <arpa/inet.h>

#define SERVER_IP "127.0.0.1"
#define PORT 8888
#define BUF_SIZE 1024

int main() {
    int sock;
    struct sockaddr_in server_addr;
    char buffer[BUF_SIZE];

    // 1. ì†Œì¼“ ìƒì„±
    sock = socket(AF_INET, SOCK_DGRAM, 0);

    // 2. ì„œë²„ ì£¼ì†Œ ì„¤ì •
    memset(&server_addr, 0, sizeof(server_addr));
    server_addr.sin_family = AF_INET;
    server_addr.sin_port = htons(PORT);
    inet_pton(AF_INET, SERVER_IP, &server_addr.sin_addr);

    while (1) {
        printf("ë³´ë‚¼ ë©”ì‹œì§€: ");
        fgets(buffer, BUF_SIZE, stdin);

        // 3. ì„œë²„ì— ë°ì´í„° ì „ì†¡
        sendto(sock, buffer, strlen(buffer), 0,
               (struct sockaddr*)&server_addr, sizeof(server_addr));

        // 4. ì„œë²„ë¡œë¶€í„° ì‘ë‹µ ìˆ˜ì‹ 
        int n = recvfrom(sock, buffer, BUF_SIZE, 0, NULL, NULL);
        buffer[n] = '\0';
        printf("ì„œë²„ ì‘ë‹µ: %s\n", buffer);
    }

    close(sock);
    return 0;
}
```

------

### ğŸ“Œ 3. ì£¼ì˜ì‚¬í•­ ë° íŒ

| ì£¼ì œ         | ì„¤ëª…                                    |
| ------------ | --------------------------------------- |
| `recvfrom()` | ë³´ë‚¸ í´ë¼ì´ì–¸íŠ¸ì˜ ì£¼ì†Œê°€ í•¨ê»˜ ì „ë‹¬ë¨    |
| `sendto()`   | ë§¤ë²ˆ ëª©ì ì§€ ì£¼ì†Œ ëª…ì‹œ                   |
| ë°ì´í„° ìœ ì‹¤  | ì†ì‹¤ ê°ì§€ ë° ì¬ì „ì†¡ì€ ì§ì ‘ êµ¬í˜„í•´ì•¼ í•¨  |
| MTU ì´ˆê³¼     | 1472ë°”ì´íŠ¸ ì´ìƒì´ë©´ IP ì¡°ê°í™” ë°œìƒ ì£¼ì˜ |

------

### ğŸ§ª í…ŒìŠ¤íŠ¸

ì„œë²„ ì‹¤í–‰:

```
gcc -o udp_server udp_server.c
./udp_server
```

í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰:

```
gcc -o udp_client udp_client.c
./udp_client
```

------

### âœ… ì •ë¦¬ ìš”ì•½

| í•­ëª©        | TCP                         | UDP                         |
| ----------- | --------------------------- | --------------------------- |
| ì—°ê²° ì—¬ë¶€   | ì—°ê²° ì§€í–¥ (3-way handshake) | ë¹„ì—°ê²°í˜•                    |
| API         | `listen`, `accept` ë“±       | ì—†ìŒ (`sendto`, `recvfrom`) |
| ë°ì´í„° íë¦„ | ìŠ¤íŠ¸ë¦¼                      | ë©”ì‹œì§€ ë‹¨ìœ„                 |
| ì‚¬ìš© ì˜ˆ     | HTTP, SSH                   | DNS, VoIP                   |

## 4.2 `recvfrom`, `sendto` í•¨ìˆ˜ ì´í•´

### ğŸ“Œ `sendto()` í•¨ìˆ˜

#### ğŸ“˜ ì •ì˜

```
ssize_t sendto(int sockfd, const void *buf, size_t len, int flags,
               const struct sockaddr *dest_addr, socklen_t addrlen);
```

| ì¸ì        | ì„¤ëª…                                              |
| ----------- | ------------------------------------------------- |
| `sockfd`    | UDP ì†Œì¼“ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°                          |
| `buf`       | ë³´ë‚¼ ë°ì´í„° ë²„í¼                                  |
| `len`       | ë³´ë‚¼ ë°ì´í„° ê¸¸ì´                                  |
| `flags`     | ì¼ë°˜ì ìœ¼ë¡œ `0`                                    |
| `dest_addr` | ëª©ì ì§€ ì£¼ì†Œ (`struct sockaddr_in*`)               |
| `addrlen`   | ì£¼ì†Œ êµ¬ì¡°ì²´ì˜ í¬ê¸° (`sizeof(struct sockaddr_in)`) |

#### âœ… ë°˜í™˜ê°’

- ì„±ê³µ: ì „ì†¡í•œ ë°”ì´íŠ¸ ìˆ˜
- ì‹¤íŒ¨: `-1` ë°˜í™˜

#### ğŸ§ª ì˜ˆì œ

```
sendto(sock, "PING", 4, 0, (struct sockaddr*)&server_addr, sizeof(server_addr));
```

------

### ğŸ“Œ `recvfrom()` í•¨ìˆ˜

#### ğŸ“˜ ì •ì˜

```
ssize_t recvfrom(int sockfd, void *buf, size_t len, int flags,
                 struct sockaddr *src_addr, socklen_t *addrlen);
```

| ì¸ì       | ì„¤ëª…                                        |
| ---------- | ------------------------------------------- |
| `sockfd`   | ìˆ˜ì‹  ëŒ€ê¸° ì¤‘ì¸ ì†Œì¼“ FD                      |
| `buf`      | ìˆ˜ì‹  ë°ì´í„°ë¥¼ ì €ì¥í•  ë²„í¼                   |
| `len`      | ë²„í¼ í¬ê¸°                                   |
| `flags`    | ì¼ë°˜ì ìœ¼ë¡œ `0`                              |
| `src_addr` | ë°ì´í„°ë¥¼ ë³´ë‚¸ í´ë¼ì´ì–¸íŠ¸ì˜ ì£¼ì†Œ (ì¶œì²˜ ì €ì¥) |
| `addrlen`  | ì£¼ì†Œ êµ¬ì¡°ì²´ì˜ í¬ê¸° (ì…ì¶œë ¥)                 |

#### âœ… ë°˜í™˜ê°’

- ì„±ê³µ: ìˆ˜ì‹ í•œ ë°”ì´íŠ¸ ìˆ˜
- ì‹¤íŒ¨: `-1` ë°˜í™˜

#### ğŸ§ª ì˜ˆì œ

```
char buffer[1024];
struct sockaddr_in client;
socklen_t clen = sizeof(client);

int n = recvfrom(sock, buffer, sizeof(buffer), 0,
                 (struct sockaddr*)&client, &clen);
```

- í´ë¼ì´ì–¸íŠ¸ ì£¼ì†ŒëŠ” `client`ì— ì €ì¥ë¨
- ì‘ë‹µ ë³´ë‚¼ ë•ŒëŠ” ì´ ì£¼ì†Œë¥¼ ê·¸ëŒ€ë¡œ `sendto()`ì— ì¬ì‚¬ìš©

------

### âœ… ì£¼ìš” ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

| ìƒí™©           | `recvfrom()`                         | `sendto()`                   |
| -------------- | ------------------------------------ | ---------------------------- |
| UDP ì„œë²„       | í´ë¼ì´ì–¸íŠ¸ ì£¼ì†Œë¥¼ ì•Œì•„ì•¼ í•˜ë¯€ë¡œ ì‚¬ìš© | ì‘ë‹µì„ ë³´ë‚´ê¸° ìœ„í•´ ì‚¬ìš©      |
| UDP í´ë¼ì´ì–¸íŠ¸ | ë³´í†µ ìƒëŒ€ ì£¼ì†Œ í•„ìš” ì—†ìŒ â†’ NULL ê°€ëŠ¥ | í•­ìƒ ëª©ì ì§€ ì£¼ì†Œ ì§€ì •í•´ì•¼ í•¨ |

```
recvfrom(sock, buffer, sizeof(buffer), 0, NULL, NULL); // ì£¼ì†Œ ë¬´ì‹œ ê°€ëŠ¥
```

------

### ğŸ“Œ flags ì˜µì…˜

- `MSG_DONTWAIT`: ë¸”ë¡œí‚¹ ì—†ì´ í˜¸ì¶œ
- `MSG_PEEK`: ë°ì´í„°ë¥¼ ì†Œë¹„í•˜ì§€ ì•Šê³  ë¯¸ë¦¬ ë³´ê¸°

```
recvfrom(sock, buffer, sizeof(buffer), MSG_PEEK, NULL, NULL); // ë²„í¼ ìœ ì§€ë¨
```

------

### âœ… ì •ë¦¬ ìš”ì•½

| í•­ëª©      | `sendto()`                    | `recvfrom()`           |
| --------- | ----------------------------- | ---------------------- |
| ë™ì‘      | ë°ì´í„°ë¥¼ ì „ì†¡                 | ë°ì´í„°ë¥¼ ìˆ˜ì‹           |
| ì£¼ì†Œ í•„ìš” | ëª©ì ì§€ ì£¼ì†Œ í•„ìˆ˜              | ì¶œì²˜ ì£¼ì†Œ ì €ì¥ìš©       |
| UDP ì„œë²„  | í´ë¼ì´ì–¸íŠ¸ ì‘ë‹µ ì‹œ ì‚¬ìš©       | í´ë¼ì´ì–¸íŠ¸ ì£¼ì†Œ ì¶”ì¶œìš© |
| TCPì—ì„œ   | ë³´í†µ ì‚¬ìš© ì•ˆ í•¨ (stream ê¸°ë°˜) | ì‚¬ìš© ì•ˆ í•¨             |

## 4.3 í´ë¼ì´ì–¸íŠ¸ ì£¼ì†Œ ì‹ë³„ ë° ì²˜ë¦¬

### ğŸ“Œ ì™œ ì‹ë³„ì´ í•„ìš”í•œê°€?

UDPëŠ” ìƒíƒœë¥¼ ìœ ì§€í•˜ì§€ ì•Šì•„, ì„œë²„ê°€ ìˆ˜ì‹ í•œ ë°ì´í„°ê°€ **ëˆ„ê°€ ë³´ëƒˆëŠ”ì§€** ì•Œ ìˆ˜ ì—†ìœ¼ë©´ **ì‘ë‹µì„ ë³´ë‚¼ ìˆ˜ ì—†ì–´**.

ë”°ë¼ì„œ `recvfrom()` í˜¸ì¶œ ì‹œ **ë°œì‹ ì ì£¼ì†Œë¥¼ í•¨ê»˜ ì¶”ì¶œ**í•´ì„œ ì €ì¥í•´ë‘ê³ , `sendto()` í˜¸ì¶œ ì‹œ ê·¸ ì£¼ì†Œë¥¼ ì´ìš©í•´ì„œ ë‹¤ì‹œ ì‘ë‹µì„ ë³´ë‚´ëŠ” ë°©ì‹ìœ¼ë¡œ ì‘ë™í•´ì•¼ í•¨.

------

### ğŸ“˜ ê¸°ë³¸ ì˜ˆì œ ì½”ë“œ (UDP ì„œë²„)

```
#include <stdio.h>
#include <string.h>
#include <arpa/inet.h>
#include <sys/socket.h>
#include <unistd.h>

int main() {
    int sock;
    struct sockaddr_in server_addr, client_addr;
    socklen_t client_len = sizeof(client_addr);
    char buffer[1024];

    sock = socket(AF_INET, SOCK_DGRAM, 0);
    
    memset(&server_addr, 0, sizeof(server_addr));
    server_addr.sin_family = AF_INET;
    server_addr.sin_port = htons(8888);
    server_addr.sin_addr.s_addr = htonl(INADDR_ANY);

    bind(sock, (struct sockaddr*)&server_addr, sizeof(server_addr));

    while (1) {
        int n = recvfrom(sock, buffer, sizeof(buffer), 0,
                         (struct sockaddr*)&client_addr, &client_len);

        buffer[n] = '\0';

        printf("ğŸ‘¤ Client IP: %s, Port: %d\n",
               inet_ntoa(client_addr.sin_addr), ntohs(client_addr.sin_port));
        printf("ğŸ“¥ Received: %s\n", buffer);

        // ì‘ë‹µ ì „ì†¡
        sendto(sock, buffer, n, 0,
               (struct sockaddr*)&client_addr, client_len);
    }

    close(sock);
    return 0;
}
```

------

### âœ… í•µì‹¬ í•¨ìˆ˜: `inet_ntoa()`, `ntohs()`

- `inet_ntoa(client_addr.sin_addr)` â†’ IPv4 ì£¼ì†Œ ë¬¸ìì—´ ë°˜í™˜
- `ntohs(client_addr.sin_port)` â†’ í¬íŠ¸ ë²ˆí˜¸ë¥¼ í˜¸ìŠ¤íŠ¸ ë°”ì´íŠ¸ ìˆœì„œë¡œ ë³€í™˜

------

### ğŸ§  í´ë¼ì´ì–¸íŠ¸ë³„ ì‘ë‹µ ë¶„ê¸° ì²˜ë¦¬ ì˜ˆì‹œ

```
if (strcmp(inet_ntoa(client_addr.sin_addr), "192.168.0.100") == 0) {
    printf("íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ ì²˜ë¦¬ ë¡œì§ ì‹¤í–‰\n");
}
```

------

### ğŸ“¦ ì‘ìš©: í´ë¼ì´ì–¸íŠ¸ ì£¼ì†Œë¥¼ ë¬¸ìì—´ë¡œ ì €ì¥

```
char ip_str[INET_ADDRSTRLEN];
inet_ntop(AF_INET, &(client_addr.sin_addr), ip_str, sizeof(ip_str));

printf("í´ë¼ì´ì–¸íŠ¸ IP ë¬¸ìì—´: %s\n", ip_str);
```

> IPv6ì˜ ê²½ìš° `AF_INET6`ì™€ `struct sockaddr_in6`ë¥¼ ì‚¬ìš©í•˜ë©´ ë¨.

------

### ğŸ”’ ì£¼ì˜í•  ì 

- UDPëŠ” ìƒíƒœê°€ ì—†ìœ¼ë¯€ë¡œ, **ë§¤ë²ˆ ì£¼ì†Œë¥¼ ì €ì¥í•˜ê³  ì°¸ì¡°**í•´ì•¼ í•œë‹¤.
- í´ë¼ì´ì–¸íŠ¸ì™€ì˜ ìƒíƒœ ìœ ì§€ê°€ í•„ìš”í•˜ë©´, ì£¼ì†Œë³„ë¡œ contextë¥¼ **ë³„ë„ êµ¬ì¡°ì²´ë‚˜ í•´ì‹œë§µì— ì €ì¥**í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬ì„±í•´ì•¼ í•¨.
- ë™ì¼ í´ë¼ì´ì–¸íŠ¸ë¼ë„ **í¬íŠ¸ê°€ ë°”ë€Œë©´ ë‹¤ë¥¸ ì—”í‹°í‹°ë¡œ ê°„ì£¼**ëœë‹¤.

------

### âœ… ìš”ì•½

| í•­ëª©        | ë‚´ìš©                                 |
| ----------- | ------------------------------------ |
| ì£¼ì†Œ ì¶”ì¶œ   | `recvfrom()`ì˜ `src_addr` ì¸ì ì‚¬ìš©  |
| ë¬¸ìì—´ ë³€í™˜ | `inet_ntoa()`, `inet_ntop()` ì‚¬ìš©    |
| í¬íŠ¸ ì¶”ì¶œ   | `ntohs(client_addr.sin_port)`        |
| ì‘ë‹µ ì „ì†¡   | `sendto()`ì—ì„œ ì¶”ì¶œëœ ì£¼ì†Œ ì¬ì‚¬ìš©    |
| í™•ì¥ ì²˜ë¦¬   | í´ë¼ì´ì–¸íŠ¸ë³„ êµ¬ì¡°ì²´ ê´€ë¦¬ë¡œ ìƒíƒœ ì¶”ì  |

## 4.4 UDP íŒ¨í‚· ì†ì‹¤/ìˆœì„œ ë¬¸ì œ ëŒ€ì‘

### ğŸš¨ UDPì˜ ì£¼ìš” í•œê³„

| ë¬¸ì œ               | ì„¤ëª…                                                   |
| ------------------ | ------------------------------------------------------ |
| âŒ íŒ¨í‚· ì†ì‹¤        | ì¤‘ê°„ì— íŒ¨í‚·ì´ ìœ ì‹¤ë˜ì–´ë„ ì¬ì „ì†¡í•˜ì§€ ì•ŠìŒ               |
| âŒ ìˆœì„œ ë³´ì¥ ì—†ìŒ   | ìˆ˜ì‹  ìˆœì„œê°€ ì†¡ì‹  ìˆœì„œì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ                   |
| âŒ íë¦„ ì œì–´ ì—†ìŒ   | ì†¡ì‹ ìê°€ ê³¼ë„í•˜ê²Œ ë³´ë‚´ë©´ ìˆ˜ì‹ ìê°€ ë²„í¼ ì˜¤ë²„í”Œë¡œìš° ê°€ëŠ¥ |
| âŒ ì¤‘ë³µ ìˆ˜ì‹  ê°€ëŠ¥ì„± | ê°™ì€ íŒ¨í‚·ì´ ë‘ ë²ˆ ë„ì°©í•  ìˆ˜ë„ ìˆìŒ                     |

------

### âœ… ì¼ë°˜ì ì¸ ëŒ€ì‘ ì „ëµ

#### 1. **ì‹œí€€ìŠ¤ ë²ˆí˜¸ ë¶€ì—¬**

```
struct packet {
    uint32_t seq_num;   // ì‹œí€€ìŠ¤ ë²ˆí˜¸
    char data[1024];    // ì‹¤ì œ ë°ì´í„°
};
```

- ìˆ˜ì‹ ìëŠ” `seq_num` ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•˜ê±°ë‚˜ ì¤‘ë³µ ì œê±° ê°€ëŠ¥
- ì†¡ì‹ ìëŠ” ì†¡ì‹ í•œ íŒ¨í‚·ì„ `seq_num` ê¸°ì¤€ìœ¼ë¡œ ì¬ì „ì†¡ ê´€ë¦¬ ê°€ëŠ¥

------

#### 2. **ACK/NACK (ì‘ë‹µ) ê¸°ë°˜ ì¬ì „ì†¡ êµ¬í˜„**

- í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„ë¡œ ì „ì†¡ í›„, ì„œë²„ê°€ `ACK(seq_num)` ì‘ë‹µ
- ì‘ë‹µì´ ì¼ì • ì‹œê°„ ë‚´ ë„ì°©í•˜ì§€ ì•Šìœ¼ë©´ í´ë¼ì´ì–¸íŠ¸ê°€ ì¬ì „ì†¡

```
// sendto() í›„ select()ë¡œ ì‘ë‹µ ëŒ€ê¸°
fd_set readfds;
struct timeval timeout = {2, 0}; // 2ì´ˆ ëŒ€ê¸°

FD_ZERO(&readfds);
FD_SET(sockfd, &readfds);

int ready = select(sockfd + 1, &readfds, NULL, NULL, &timeout);
if (ready == 0) {
    // íƒ€ì„ì•„ì›ƒ: ì¬ì „ì†¡ ë¡œì§
}
```

------

#### 3. **ìˆœì„œ ì¬ì¡°ë¦½ ë²„í¼ ì‚¬ìš©**

- ë„ì°©í•œ íŒ¨í‚·ì„ ì„ì‹œ ë²„í¼ì— ì €ì¥
- `seq_num`ì´ ëˆ„ë½ëœ ê²½ìš° ë‹¤ìŒ íŒ¨í‚·ì€ ì¼ë‹¨ ë³´ë¥˜
- ëˆ„ë½ëœ íŒ¨í‚· ë„ì°© ì‹œ ì¬ì¡°ë¦½

```
// Pseudo-buffer: ë²„í¼[seq_num] = ë°ì´í„°
char* reassembly_buffer[MAX_SEQ];
```

------

#### 4. **Sliding Window (ìŠ¬ë¼ì´ë”© ìœˆë„ìš°) ê¸°ë²•**

- ì—¬ëŸ¬ íŒ¨í‚·ì„ ì—°ì†í•´ì„œ ë³´ë‚´ë˜, ì¼ì • ë²”ìœ„(window) ë‚´ì—ì„œë§Œ ACK í™•ì¸
- TCPì™€ ìœ ì‚¬í•œ íë¦„ ì œì–´ ê°€ëŠ¥
- êµ¬í˜„ì€ ë³µì¡í•˜ì§€ë§Œ ì„±ëŠ¥/ì‹ ë¢°ì„± ê°œì„  íš¨ê³¼ í¼

------

#### 5. **ì‘ìš© ê³„ì¸µì—ì„œ ìˆœì„œ ë³´ì¥ ë¡œì§ ì‘ì„±**

- ë³´ë‚¸ ìˆœì„œëŒ€ë¡œ í ì²˜ë¦¬í•˜ê³ ,
- ì´ì „ ì‹œí€€ìŠ¤ë³´ë‹¤ ë‚®ì€ ë²ˆí˜¸ëŠ” ë¬´ì‹œí•˜ê±°ë‚˜ ë²„í¼ì— ë³´ê´€
- ë°ì´í„°ë² ì´ìŠ¤ë‚˜ ë¡œê·¸ ì²˜ë¦¬ ì‹œ ìœ ìš©

------

### ğŸ“¦ ì˜ˆì‹œ ì‹œí€€ìŠ¤ ë²ˆí˜¸ í¬í•¨ ì†¡ìˆ˜ì‹  êµ¬ì¡°

#### ì†¡ì‹  ì¸¡

```
struct packet pkt;
pkt.seq_num = htonl(1);
strcpy(pkt.data, "Hello");

sendto(sock, &pkt, sizeof(pkt), 0,
       (struct sockaddr*)&addr, sizeof(addr));
```

#### ìˆ˜ì‹  ì¸¡

```
struct packet recv_pkt;
recvfrom(sock, &recv_pkt, sizeof(recv_pkt), 0,
         (struct sockaddr*)&client, &len);

uint32_t seq = ntohl(recv_pkt.seq_num);
printf("ë°›ì€ ì‹œí€€ìŠ¤ ë²ˆí˜¸: %u\n", seq);
```

------

### âœ… ì‹¤ì œ ì‹œìŠ¤í…œì—ì„œì˜ ì˜ˆ

| ì‹œìŠ¤í…œ              | í•´ê²° ì „ëµ                                               |
| ------------------- | ------------------------------------------------------- |
| **VoIP**            | ì‹¤ì‹œê°„ì„± ì¤‘ìš” â†’ ì¼ë¶€ ì†ì‹¤ í—ˆìš©, ìˆœì„œ ì •ë ¬ ì‚¬ìš©          |
| **TFTP**            | ë‹¨ìˆœ ACK ì¬ì „ì†¡ ê¸°ë°˜ ì‹ ë¢°ì„± í™•ë³´                        |
| **DNS**             | ì†ì‹¤ ì‹œ í´ë¼ì´ì–¸íŠ¸ê°€ ì¬ìš”ì²­                             |
| **QUIC (UDP ê¸°ë°˜)** | ìì²´ ì‹œí€€ìŠ¤/ACK/ì¬ì „ì†¡ ê¸°ëŠ¥ êµ¬í˜„ â†’ TCP ìˆ˜ì¤€ ì‹ ë¢°ì„± ì œê³µ |

------

### ğŸ§  ìš”ì•½

| ë¬¸ì œ        | ëŒ€ì‘ ì „ëµ                   |
| ----------- | --------------------------- |
| íŒ¨í‚· ì†ì‹¤   | ACK/NACK + ì¬ì „ì†¡           |
| ìˆœì„œ ë’¤ë°”ë€œ | ì‹œí€€ìŠ¤ ë²ˆí˜¸ + ì¬ì¡°ë¦½ ë²„í¼   |
| ì¤‘ë³µ ìˆ˜ì‹    | seq_num ì¤‘ë³µ ì²´í¬           |
| íë¦„ ì œì–´   | ìŠ¬ë¼ì´ë”© ìœˆë„ìš° ê¸°ë²• ë„ì…   |
| ì§€ì—°/ë¬´ì‘ë‹µ | íƒ€ì„ì•„ì›ƒ + select/poll ì‚¬ìš© |

## 4.5 DNS í´ë¼ì´ì–¸íŠ¸ ìƒ˜í”Œ êµ¬í˜„

### ğŸ“š ê¸°ë³¸ ê°œìš”

- í”„ë¡œí† ì½œ: **UDP 53ë²ˆ í¬íŠ¸**
- ëª©ì ì§€: **DNS ì„œë²„ (ì˜ˆ: 8.8.8.8)**
- êµ¬ì¡°: **DNS Query íŒ¨í‚· ìƒì„± â†’ UDP ì „ì†¡ â†’ ì‘ë‹µ ìˆ˜ì‹  ë° íŒŒì‹±**

------

### ğŸ§± DNS íŒ¨í‚· êµ¬ì¡° (ê°„ëµí™”)

| í•„ë“œ                          | ì„¤ëª…                           |
| ----------------------------- | ------------------------------ |
| Header (12 bytes)             | ID, flags, question count ë“±   |
| Question                      | ì§ˆì˜ ì´ë¦„, íƒ€ì…(A), í´ë˜ìŠ¤(IN) |
| Answer, Authority, Additional | ì‘ë‹µ ì„¸ë¶€ ì •ë³´ (ìƒëµ ê°€ëŠ¥)     |

------

### âš™ï¸ ì£¼ìš” í—¤ë” êµ¬ì¡°ì²´

```
struct DNS_HEADER {
    uint16_t id;       // ID
    uint16_t flags;    // Query/Response flags
    uint16_t q_count;  // ì§ˆë¬¸ ìˆ˜
    uint16_t ans_count;
    uint16_t auth_count;
    uint16_t add_count;
};

struct QUESTION {
    uint16_t qtype;
    uint16_t qclass;
};
```

------

### ğŸ› ï¸ ë„ë©”ì¸ ì´ë¦„ ë³€í™˜ í•¨ìˆ˜ (ì˜ˆ: "[www.google.com](http://www.google.com)" â†’ `\3www\6google\3com\0`)

```
void ChangetoDnsNameFormat(unsigned char* dns, const char* host) {
    int lock = 0, i;
    strcat((char*)host, ".");
    for (i = 0; i < strlen((char*)host); i++) {
        if (host[i] == '.') {
            *dns++ = i - lock;
            for (; lock < i; lock++) {
                *dns++ = host[lock];
            }
            lock++;
        }
    }
    *dns++ = 0; // ë í‘œì‹œ
}
```

------

### âœ… ì „ì²´ ì˜ˆì œ ì½”ë“œ (ê¸°ë³¸ DNS A ë ˆì½”ë“œ ì§ˆì˜)

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <arpa/inet.h>

#define DNS_PORT 53
#define BUF_SIZE 512

struct DNS_HEADER {
    uint16_t id, flags, q_count, ans_count, auth_count, add_count;
};

struct QUESTION {
    uint16_t qtype, qclass;
};

void ChangetoDnsNameFormat(unsigned char* dns, const char* host) {
    int lock = 0, i;
    strcat((char*)host, ".");
    for (i = 0; i < strlen((char*)host); i++) {
        if (host[i] == '.') {
            *dns++ = i - lock;
            for (; lock < i; lock++) *dns++ = host[lock];
            lock++;
        }
    }
    *dns++ = 0;
}

int main() {
    unsigned char buf[BUF_SIZE], *qname;
    struct DNS_HEADER* dns = NULL;
    struct QUESTION* qinfo = NULL;

    struct sockaddr_in dest;
    int sock = socket(AF_INET, SOCK_DGRAM, IPPROTO_UDP);
    if (sock < 0) { perror("socket"); exit(1); }

    dest.sin_family = AF_INET;
    dest.sin_port = htons(DNS_PORT);
    dest.sin_addr.s_addr = inet_addr("8.8.8.8");  // Google DNS

    dns = (struct DNS_HEADER*)&buf;

    dns->id = (uint16_t) htons(getpid());
    dns->flags = htons(0x0100);  // í‘œì¤€ ì¿¼ë¦¬
    dns->q_count = htons(1);
    dns->ans_count = dns->auth_count = dns->add_count = 0;

    qname = &buf[sizeof(struct DNS_HEADER)];
    ChangetoDnsNameFormat(qname, "example.com");

    qinfo = (struct QUESTION*)&buf[sizeof(struct DNS_HEADER) + strlen((const char*)qname) + 1];
    qinfo->qtype = htons(1);   // A ë ˆì½”ë“œ
    qinfo->qclass = htons(1);  // IN

    int len = sizeof(struct DNS_HEADER) + strlen((const char*)qname) + 1 + sizeof(struct QUESTION);
    sendto(sock, buf, len, 0, (struct sockaddr*)&dest, sizeof(dest));

    socklen_t slen = sizeof(dest);
    int rlen = recvfrom(sock, buf, BUF_SIZE, 0, (struct sockaddr*)&dest, &slen);

    printf("ğŸ§¾ ì‘ë‹µ ìˆ˜ì‹ ë¨ (%d ë°”ì´íŠ¸)\n", rlen);
    close(sock);
    return 0;
}
```

------

### ğŸ§  í•´ì„ ê²°ê³¼ ë³´ê¸°

ìœ„ ì½”ë“œëŠ” ì‘ë‹µê¹Œì§€ ë°›ì§€ë§Œ, ì•„ì§ ì‘ë‹µ íŒŒì‹±ì€ ì•ˆ í•¨.
 ë‹¤ìŒ ë‹¨ê³„ì—ì„œëŠ” `buf` ë‚´ ì‘ë‹µì„ í•´ì„í•´ì„œ A ë ˆì½”ë“œ(IP) ì¶”ì¶œ ê°€ëŠ¥. ì´ê±´ ë°”ì´ë„ˆë¦¬ ë””ì½”ë”©ì´ í•„ìš”í•´ì„œ ë”°ë¡œ ë‹¤ë¤„ì•¼ í•´.

------

### ğŸ§© ì‘ìš© íŒ

- `qtype`ì„ 28ë¡œ ì„¤ì •í•˜ë©´ IPv6 ì£¼ì†Œ(AAAA ë ˆì½”ë“œ) ìš”ì²­ ê°€ëŠ¥
- `recvfrom()` ì‘ë‹µì€ DNS ì‘ë‹µ í—¤ë” + ì‘ë‹µ ë¦¬ìŠ¤íŠ¸ â†’ ì¶”ì¶œ í•„ìš”
- `tcpdump -i lo udp port 53`ìœ¼ë¡œ ì‹¤ì œ ì „ì†¡ í™•ì¸ ê°€ëŠ¥