# 2. C ì–¸ì–´ì™€ ë¦¬ëˆ…ìŠ¤ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ ì¤€ë¹„

## 2.1 ê°œë°œ í™˜ê²½ êµ¬ì„± (GCC, GDB, Wireshark, net-tools)

### âœ… GCC (GNU Compiler Collection)

#### ğŸ“Œ ê°œìš”

GCCëŠ” C, C++, Objective-C, Fortran ë“± ì—¬ëŸ¬ ì–¸ì–´ë¥¼ ì»´íŒŒì¼í•  ìˆ˜ ìˆëŠ” **í‘œì¤€ GNU ì»´íŒŒì¼ëŸ¬**ë‹¤.
 ë„¤íŠ¸ì›Œí¬ ì†Œì¼“ í”„ë¡œê·¸ë˜ë°ì—ì„œ ê°€ì¥ ë§ì´ ì“°ì´ëŠ” **C ì»´íŒŒì¼ëŸ¬**ì´ê¸°ë„ í•˜ë‹¤.

------

#### ğŸ”§ ì„¤ì¹˜

```
sudo apt update
sudo apt install build-essential
```

> `build-essential` íŒ¨í‚¤ì§€ëŠ” `gcc`, `g++`, `make` ë“±ì„ í¬í•¨í•¨

------

#### âš™ï¸ ì‚¬ìš©ë²•

```
gcc -o server server.c
gcc -g -Wall -o client client.c   # ë””ë²„ê¹… ì •ë³´ í¬í•¨
```

| ì˜µì…˜       | ì„¤ëª…                               |
| ---------- | ---------------------------------- |
| `-o`       | ì¶œë ¥ íŒŒì¼ ì´ë¦„ ì§€ì •                |
| `-Wall`    | ëª¨ë“  ê²½ê³  ì¶œë ¥                     |
| `-g`       | ë””ë²„ê¹… ì‹¬ë³¼ í¬í•¨ (GDBìš©)           |
| `-pthread` | ë©€í‹°ìŠ¤ë ˆë“œ í”„ë¡œê·¸ë¨ ì»´íŒŒì¼ ì‹œ í•„ìš” |
| `-std=c99` | íŠ¹ì • C í‘œì¤€ ì§€ì • ê°€ëŠ¥              |

------

### âœ… GDB (GNU Debugger)

#### ğŸ“Œ ê°œìš”

GDBëŠ” C ì–¸ì–´ í”„ë¡œê·¸ë¨ì˜ **ì‹¤í–‰ íë¦„ì„ ë‹¨ê³„ë³„ë¡œ ì¶”ì í•˜ê³  ë³€ìˆ˜ ìƒíƒœë¥¼ í™•ì¸**í•  ìˆ˜ ìˆëŠ” GNU ë””ë²„ê±°ë‹¤.
 TCP ì†Œì¼“ í”„ë¡œê·¸ë˜ë°ì—ì„œëŠ” ì—°ê²° ëŒ€ê¸° ì¤‘ì§€, SIGPIPE, read/write ì˜¤ë¥˜ ë“±ì„ ë””ë²„ê¹…í•˜ëŠ” ë° í•„ìˆ˜ì ì´ë‹¤.

------

#### ğŸ”§ ì„¤ì¹˜

```
sudo apt install gdb
```

------

#### ğŸ› ï¸ ê¸°ë³¸ ì‚¬ìš©ë²•

```
gcc -g -o myserver myserver.c
gdb ./myserver
```

#### ì£¼ìš” ëª…ë ¹ì–´

| ëª…ë ¹         | ì„¤ëª…                      |
| ------------ | ------------------------- |
| `break main` | main í•¨ìˆ˜ì—ì„œ ì¤‘ë‹¨ì  ì„¤ì • |
| `run`        | í”„ë¡œê·¸ë¨ ì‹¤í–‰             |
| `next`       | ë‹¤ìŒ ì¤„ ì‹¤í–‰              |
| `step`       | í•¨ìˆ˜ ë‚´ë¶€ë¡œ ì§„ì…          |
| `print var`  | ë³€ìˆ˜ ê°’ ì¶œë ¥              |
| `backtrace`  | ìŠ¤íƒ í”„ë ˆì„ ì¶œë ¥          |
| `list`       | ì†ŒìŠ¤ì½”ë“œ í‘œì‹œ             |
| `quit`       | ì¢…ë£Œ                      |

------

### âœ… Wireshark

#### ğŸ“Œ ê°œìš”

WiresharkëŠ” ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì˜¤ê°€ëŠ” **íŒ¨í‚·ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¶„ì„í•˜ê³  ì‹œê°í™”**í•  ìˆ˜ ìˆëŠ” ê°•ë ¥í•œ ë„êµ¬ë‹¤.
 TCP/UDP ì—°ê²° íë¦„, íŒ¨í‚· ì†ì‹¤, í¬íŠ¸ ìƒíƒœ, í”„ë¡œí† ì½œ êµ¬ì¡° í™•ì¸ì— ì‚¬ìš©ë¨.

------

#### ğŸ”§ ì„¤ì¹˜

```
sudo apt install wireshark
sudo usermod -aG wireshark $USER
```

> ì¬ë¶€íŒ… í›„ ì¼ë°˜ ì‚¬ìš©ìë„ íŒ¨í‚· ìº¡ì²˜ ê°€ëŠ¥

------

#### ğŸ” ì£¼ìš” ê¸°ëŠ¥

| ê¸°ëŠ¥              | ì„¤ëª…                                               |
| ----------------- | -------------------------------------------------- |
| í•„í„°              | `tcp.port == 8080`, `ip.addr == 192.168.0.10`      |
| Follow TCP stream | ì—°ê²° ì „ì²´ ë‚´ìš©ì„ ì¬êµ¬ì„±                            |
| Protocol decoding | HTTP, DNS, TLS êµ¬ì¡°ë¥¼ ê³„ì¸µë³„ë¡œ ë¶„ì„ ê°€ëŠ¥           |
| ì‹¤ì‹œê°„ ìº¡ì²˜       | ì¸í„°í˜ì´ìŠ¤ ì„ íƒ í›„ `Start` ëˆ„ë¥´ë©´ ì‹¤ì‹œê°„ íŒ¨í‚· í‘œì‹œ |

------

#### ğŸ§ª ì‚¬ìš© ì˜ˆ

1. `sudo wireshark` ì‹¤í–‰
2. `eth0` ì„ íƒ í›„ ìº¡ì²˜ ì‹œì‘
3. TCP ì—°ê²° í•„í„°: `tcp.stream eq 0`
4. HTTP ì‘ë‹µ í™•ì¸: `http.response`

------

### âœ… net-tools (ifconfig, netstat ë“±)

#### ğŸ“Œ ê°œìš”

`net-tools`ëŠ” **ì „í†µì ì¸ ë„¤íŠ¸ì›Œí¬ ì§„ë‹¨ ë° ìƒíƒœ í™•ì¸ ë„êµ¬ ëª¨ìŒ**ì´ë‹¤.
 ìš”ì¦˜ì€ `ip`, `ss`ë¡œ ëŒ€ì²´ë˜ê³  ìˆì§€ë§Œ ì—¬ì „íˆ ë§ì´ ì“°ì¸ë‹¤.

------

#### ğŸ”§ ì„¤ì¹˜

```
sudo apt install net-tools
```

------

#### ğŸ§° ì£¼ìš” ëª…ë ¹ì–´

| ëª…ë ¹            | ì„¤ëª…                    |
| --------------- | ----------------------- |
| `ifconfig`      | ì¸í„°í˜ì´ìŠ¤ IP ì£¼ì†Œ í™•ì¸ |
| `netstat -anpt` | ëª¨ë“  í¬íŠ¸ì™€ PID í™•ì¸    |
| `netstat -i`    | íŒ¨í‚· í†µê³„ ë³´ê¸°          |
| `netstat -r`    | ë¼ìš°íŒ… í…Œì´ë¸” í™•ì¸      |
| `arp -a`        | ARP ìºì‹œ ì¡°íšŒ           |

------

### ğŸ“¦ ê°œë°œ í™˜ê²½ í†µí•© íŒ

| ë„êµ¬      | í†µí•© ëª©ì                                              |
| --------- | ----------------------------------------------------- |
| GCC + GDB | ë²„ê·¸ ì¶”ì  ë° ë°ì´í„° í™•ì¸                              |
| Wireshark | ì‹¤ì œ íŠ¸ë˜í”½ í™•ì¸ (3-way handshake, FIN ë“±)            |
| net-tools | ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ (í¬íŠ¸ ì—´ë¦¼ ì—¬ë¶€, ì¸í„°í˜ì´ìŠ¤ ë™ì‘ ë“±) |

------

### âœ… ìš”ì•½ ì •ë¦¬

| ë„êµ¬          | ìš©ë„                  | ëª…ë ¹ ì˜ˆ               |
| ------------- | --------------------- | --------------------- |
| **GCC**       | ì»´íŒŒì¼                | `gcc -o app app.c`    |
| **GDB**       | ë””ë²„ê¹…                | `gdb ./app`           |
| **Wireshark** | íŒ¨í‚· ë¶„ì„             | GUI ë˜ëŠ” CLI `tshark` |
| **net-tools** | ì¸í„°í˜ì´ìŠ¤, í¬íŠ¸ ì§„ë‹¨ | `ifconfig`, `netstat` |

## 2.2 ì£¼ìš” í—¤ë” íŒŒì¼ ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ (`<sys/socket.h>`, `<netinet/in.h>`, `<arpa/inet.h>`, `<unistd.h>`)

### âœ… 1. `<sys/socket.h>` â€” ì†Œì¼“ ìƒì„±ê³¼ ì„¤ì •ì˜ ì¤‘ì‹¬

#### ğŸ“Œ ì—­í• 

- ì†Œì¼“ ê´€ë ¨ **í•¨ìˆ˜ì™€ ìƒìˆ˜**, **ê³µí†µ êµ¬ì¡°ì²´**ë“¤ì„ ì •ì˜
- `socket()`, `bind()`, `listen()`, `accept()`, `connect()` í•¨ìˆ˜ ì„ ì–¸

------

#### ğŸ“‹ ì£¼ìš” í•¨ìˆ˜

| í•¨ìˆ˜               | ì„¤ëª…                               |
| ------------------ | ---------------------------------- |
| `socket()`         | ì†Œì¼“ ìƒì„±                          |
| `bind()`           | ì†Œì¼“ì— IP/í¬íŠ¸ ë°”ì¸ë”©              |
| `listen()`         | ì—°ê²° ìš”ì²­ ëŒ€ê¸° ìƒíƒœ ì§„ì…           |
| `accept()`         | í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ìˆ˜ë½               |
| `connect()`        | ì„œë²„ì— ì—°ê²° ìš”ì²­ (í´ë¼ì´ì–¸íŠ¸ìš©)    |
| `send()`, `recv()` | ë°ì´í„° ì „ì†¡/ìˆ˜ì‹                    |
| `setsockopt()`     | ì†Œì¼“ ì˜µì…˜ ì„¤ì • (`SO_REUSEADDR` ë“±) |

------

#### ğŸ“‹ ì£¼ìš” ìƒìˆ˜

| ìƒìˆ˜                           | ì„¤ëª…           |
| ------------------------------ | -------------- |
| `AF_INET`                      | IPv4 ì£¼ì†Œ ì²´ê³„ |
| `AF_INET6`                     | IPv6 ì£¼ì†Œ ì²´ê³„ |
| `SOCK_STREAM`                  | TCP ì—°ê²°í˜•     |
| `SOCK_DGRAM`                   | UDP ë¹„ì—°ê²°í˜•   |
| `SOL_SOCKET`                   | ì†Œì¼“ ì˜µì…˜ ë ˆë²¨ |
| `SO_REUSEADDR`, `SO_KEEPALIVE` | ì†Œì¼“ ì˜µì…˜ ì¢…ë¥˜ |

------

#### ğŸ“‹ ì£¼ìš” êµ¬ì¡°ì²´

```
struct sockaddr {
    sa_family_t sa_family;     // ì£¼ì†Œ ì²´ê³„ (AF_INET ë“±)
    char        sa_data[14];   // ì£¼ì†Œ + í¬íŠ¸ ì •ë³´ (ì‹¤ì œë¡œëŠ” ë¯¸ì‚¬ìš©)
};
```

- ì‹¤ì œ ì‚¬ìš©ì€ `sockaddr_in`ì„ í˜•ë³€í™˜í•˜ì—¬ ì „ë‹¬

------

### âœ… 2. `<netinet/in.h>` â€” IPì™€ í¬íŠ¸ë¥¼ ìœ„í•œ êµ¬ì¡°ì²´ ì •ì˜

#### ğŸ“Œ ì—­í• 

- **IPv4/IPv6 ì£¼ì†Œ êµ¬ì¡°ì²´**, í¬íŠ¸ ì²˜ë¦¬, í”„ë¡œí† ì½œ ìƒìˆ˜ ì •ì˜
- ì†Œì¼“ ì£¼ì†Œì— **IP/í¬íŠ¸ ì •ë³´ ì „ë‹¬** ì‹œ ì‚¬ìš©

------

#### ğŸ“‹ ì£¼ìš” êµ¬ì¡°ì²´

```
struct sockaddr_in {
    sa_family_t     sin_family;   // AF_INET
    in_port_t       sin_port;     // í¬íŠ¸ (network byte order)
    struct in_addr  sin_addr;     // IP ì£¼ì†Œ êµ¬ì¡°ì²´
    char            sin_zero[8];  // padding
};
```

```
struct in_addr {
    in_addr_t s_addr;   // IP ì£¼ì†Œ (network byte order)
};
```

> IPv6ì˜ ê²½ìš° `struct sockaddr_in6`, `struct in6_addr` ì‚¬ìš©

------

#### ğŸ“‹ ì£¼ìš” ìƒìˆ˜

| ìƒìˆ˜              | ì„¤ëª…                              |
| ----------------- | --------------------------------- |
| `INADDR_ANY`      | 0.0.0.0: ëª¨ë“  ì¸í„°í˜ì´ìŠ¤ì—ì„œ ìˆ˜ì‹  |
| `INADDR_LOOPBACK` | 127.0.0.1                         |
| `IPPROTO_TCP`     | TCP í”„ë¡œí† ì½œ                      |
| `IPPROTO_UDP`     | UDP í”„ë¡œí† ì½œ                      |

------

### âœ… 3. `<arpa/inet.h>` â€” IP ì£¼ì†Œ ë³€í™˜ ì „ë‹´

#### ğŸ“Œ ì—­í• 

- IP ì£¼ì†Œì™€ í¬íŠ¸ì˜ **ë°”ì´íŠ¸ ìˆœì„œ ë³€í™˜**, **ë¬¸ìì—´ â†” ì´ì§„ ë³€í™˜** ì²˜ë¦¬

------

#### ğŸ“‹ ì£¼ìš” í•¨ìˆ˜

| í•¨ìˆ˜          | ì„¤ëª…                                        |
| ------------- | ------------------------------------------- |
| `inet_pton()` | í…ìŠ¤íŠ¸ â†’ ë°”ì´ë„ˆë¦¬ (presentation â†’ network)  |
| `inet_ntop()` | ë°”ì´ë„ˆë¦¬ â†’ í…ìŠ¤íŠ¸ (network â†’ presentation)  |
| `inet_addr()` | ë¬¸ìì—´ IPë¥¼ `in_addr_t`ë¡œ ë³€í™˜ (deprecated) |
| `inet_ntoa()` | `in_addr` â†’ ë¬¸ìì—´ (deprecated)             |

```
inet_pton(AF_INET, "192.168.0.1", &addr.sin_addr);
inet_ntop(AF_INET, &addr.sin_addr, ip_str, sizeof(ip_str));
```

------

#### ğŸ“‹ ë°”ì´íŠ¸ ìˆœì„œ ë³€í™˜

| í•¨ìˆ˜      | ì—­í•                                    |
| --------- | -------------------------------------- |
| `htons()` | í˜¸ìŠ¤íŠ¸ â†’ ë„¤íŠ¸ì›Œí¬ ë°”ì´íŠ¸ (16ë¹„íŠ¸ í¬íŠ¸) |
| `htonl()` | í˜¸ìŠ¤íŠ¸ â†’ ë„¤íŠ¸ì›Œí¬ ë°”ì´íŠ¸ (32ë¹„íŠ¸ IP)   |
| `ntohs()` | ë„¤íŠ¸ì›Œí¬ â†’ í˜¸ìŠ¤íŠ¸ ë°”ì´íŠ¸ (16ë¹„íŠ¸)      |
| `ntohl()` | ë„¤íŠ¸ì›Œí¬ â†’ í˜¸ìŠ¤íŠ¸ ë°”ì´íŠ¸ (32ë¹„íŠ¸)      |

------

### âœ… 4. `<unistd.h>` â€” POSIX ì‹œìŠ¤í…œ í˜¸ì¶œ ì„ ì–¸

#### ğŸ“Œ ì—­í• 

- **íŒŒì¼/ì†Œì¼“ ë””ìŠ¤í¬ë¦½í„° ê´€ë ¨ í•¨ìˆ˜**, `read()`, `write()`, `close()` ë“± ì„ ì–¸
- **ì†Œì¼“ì„ ë‹«ì„ ë•Œ ë°˜ë“œì‹œ í•„ìš”**

------

#### ğŸ“‹ ì£¼ìš” í•¨ìˆ˜

| í•¨ìˆ˜                | ì„¤ëª…                           |
| ------------------- | ------------------------------ |
| `close(fd)`         | ì†Œì¼“ ë˜ëŠ” íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° ì¢…ë£Œ |
| `read(fd, buf, n)`  | ë°ì´í„° ì½ê¸°                    |
| `write(fd, buf, n)` | ë°ì´í„° ì“°ê¸°                    |
| `sleep(n)`          | ì´ˆ ë‹¨ìœ„ ìŠ¬ë¦½                   |
| `usleep(us)`        | ë§ˆì´í¬ë¡œì´ˆ ë‹¨ìœ„ ìŠ¬ë¦½           |

------

### ğŸ§ª ì „ì²´ ì˜ˆì‹œ ì½”ë“œ ìŠ¤ë‹ˆí«

```
#include <stdio.h>
#include <string.h>
#include <unistd.h>
#include <arpa/inet.h>
#include <sys/socket.h>
#include <netinet/in.h>

int main() {
    int server_fd = socket(AF_INET, SOCK_STREAM, 0);

    struct sockaddr_in addr;
    addr.sin_family = AF_INET;
    addr.sin_port = htons(8080);
    addr.sin_addr.s_addr = INADDR_ANY;

    bind(server_fd, (struct sockaddr*)&addr, sizeof(addr));
    listen(server_fd, 5);

    struct sockaddr_in client_addr;
    socklen_t len = sizeof(client_addr);
    int client_fd = accept(server_fd, (struct sockaddr*)&client_addr, &len);

    char buffer[1024];
    read(client_fd, buffer, sizeof(buffer));
    write(client_fd, "Hello", 5);

    close(client_fd);
    close(server_fd);
    return 0;
}
```

------

### âœ… ìš”ì•½ ì •ë¦¬

| í—¤ë”             | ì£¼ìš” ê¸°ëŠ¥              | ê³„ì¸µì  ì—­í•         |
| ---------------- | ---------------------- | ------------------ |
| `<sys/socket.h>` | ì†Œì¼“ ìƒì„± ë° í†µì‹  í•¨ìˆ˜ | ì†Œì¼“ API           |
| `<netinet/in.h>` | IP/Port êµ¬ì¡°ì²´ ì •ì˜    | ì „ì†¡/ë„¤íŠ¸ì›Œí¬ ê³„ì¸µ |
| `<arpa/inet.h>`  | ì£¼ì†Œ ë³€í™˜, ë°”ì´íŠ¸ ìˆœì„œ | ë„¤íŠ¸ì›Œí¬ ê³„ì¸µ      |
| `<unistd.h>`     | ì†Œì¼“ ë‹«ê¸°, read/write  | POSIX ì‹œìŠ¤í…œ API   |

## 2.3 `socket`, `bind`, `listen`, `accept`, `connect`, `send`, `recv` í•¨ìˆ˜ ì†Œê°œ

ë‹¤ë£° í•¨ìˆ˜:

```
socket(), bind(), listen(), accept(), connect(), send(), recv()
```

ì´ í•¨ìˆ˜ë“¤ì€ í¬ê²Œ **ì„œë²„ ì¸¡ê³¼ í´ë¼ì´ì–¸íŠ¸ ì¸¡ìœ¼ë¡œ ë‚˜ëˆ ì„œ** ì‚¬ìš©í•˜ëŠ” êµ¬ì¡°ì´ë‹¤.

------

### âœ… [1] socket()

#### ê°œìš”

ì†Œì¼“ì„ ìƒì„±í•˜ëŠ” í•¨ìˆ˜. ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ ìœ„í•œ **íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°**ë¥¼ ë§Œë“ ë‹¤ê³  ë³´ë©´ ëœë‹¤.

#### í•¨ìˆ˜ ì›í˜•

```
int socket(int domain, int type, int protocol);
```

| ë§¤ê°œë³€ìˆ˜   | ì„¤ëª…                                               |
| ---------- | -------------------------------------------------- |
| `domain`   | ì£¼ì†Œ ì²´ê³„: `AF_INET` (IPv4), `AF_INET6` (IPv6)     |
| `type`     | í†µì‹  ë°©ì‹: `SOCK_STREAM` (TCP), `SOCK_DGRAM` (UDP) |
| `protocol` | ì¼ë°˜ì ìœ¼ë¡œ 0 (ìë™ ì„ íƒ)                           |

#### ë°˜í™˜ê°’

- ì„±ê³µ: íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° (0 ì´ìƒì˜ ì •ìˆ˜)
- ì‹¤íŒ¨: -1

------

### âœ… [2] bind()

#### ê°œìš”

ì†Œì¼“ì„ **íŠ¹ì • IP ì£¼ì†Œì™€ í¬íŠ¸ ë²ˆí˜¸ì— ì—°ê²°**í•˜ëŠ” í•¨ìˆ˜ (ì„œë²„ ì „ìš©).

#### í•¨ìˆ˜ ì›í˜•

```
int bind(int sockfd, const struct sockaddr *addr, socklen_t addrlen);
```

> `addr`ì€ ì¼ë°˜ì ìœ¼ë¡œ `struct sockaddr_in` êµ¬ì¡°ì²´ë¥¼ `(struct sockaddr *)`ë¡œ ìºìŠ¤íŒ…í•´ì„œ ì „ë‹¬

------

### âœ… [3] listen()

#### ê°œìš”

TCP ì„œë²„ ì†Œì¼“ì„ **ìˆ˜ì‹  ëŒ€ê¸° ìƒíƒœë¡œ ì „í™˜**ì‹œí‚´. ì»¤ë„ì— ì—°ê²° ëŒ€ê¸° íë¥¼ ìƒì„±.

#### í•¨ìˆ˜ ì›í˜•

```
int listen(int sockfd, int backlog);
```

| íŒŒë¼ë¯¸í„°  | ì„¤ëª…                           |
| --------- | ------------------------------ |
| `sockfd`  | socket()ìœ¼ë¡œ ìƒì„±í•œ ì†Œì¼“       |
| `backlog` | ëŒ€ê¸° ì—°ê²° ìˆ˜ (5~128 ì‚¬ì´ ì¶”ì²œ) |

------

### âœ… [4] accept()

#### ê°œìš”

í´ë¼ì´ì–¸íŠ¸ì˜ ì—°ê²° ìš”ì²­ì„ ìˆ˜ë½í•˜ê³ , **ìƒˆë¡œìš´ ì—°ê²° ì†Œì¼“**ì„ ìƒì„±í•¨.

#### í•¨ìˆ˜ ì›í˜•

```
int accept(int sockfd, struct sockaddr *addr, socklen_t *addrlen);
```

- `addr`: ì ‘ì†í•œ í´ë¼ì´ì–¸íŠ¸ì˜ ì£¼ì†Œ ì •ë³´
- `addrlen`: ì£¼ì†Œ êµ¬ì¡°ì²´ì˜ í¬ê¸°

> ë°˜í™˜ê°’ì€ **í´ë¼ì´ì–¸íŠ¸ì™€ì˜ í†µì‹  ì „ìš© ì†Œì¼“ ë””ìŠ¤í¬ë¦½í„°**

------

### âœ… [5] connect()

#### ê°œìš”

í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ì ‘ì† ìš”ì²­ì„ ë³´ëƒ„.

#### í•¨ìˆ˜ ì›í˜•

```
int connect(int sockfd, const struct sockaddr *addr, socklen_t addrlen);
```

> ì„œë²„ì˜ `bind()` + `listen()` ìƒíƒœì—ì„œë§Œ ì„±ê³µì ìœ¼ë¡œ ì—°ê²°ë¨

------

### âœ… [6] send(), recv()

#### ê°œìš”

TCP ì†Œì¼“ì„ í†µí•œ ë°ì´í„° ì „ì†¡/ìˆ˜ì‹  í•¨ìˆ˜. (ì—°ê²°í˜•ë§Œ í•´ë‹¹)

#### í•¨ìˆ˜ ì›í˜•

```
ssize_t send(int sockfd, const void *buf, size_t len, int flags);
ssize_t recv(int sockfd, void *buf, size_t len, int flags);
```

| íŒŒë¼ë¯¸í„° | ì„¤ëª…                                              |
| -------- | ------------------------------------------------- |
| `sockfd` | í†µì‹  ì¤‘ì¸ ì†Œì¼“                                    |
| `buf`    | ì „ì†¡/ìˆ˜ì‹ í•  ë°ì´í„° ë²„í¼                           |
| `len`    | ë²„í¼ í¬ê¸°                                         |
| `flags`  | ì¼ë°˜ì ìœ¼ë¡œ 0 (ë˜ëŠ” `MSG_DONTWAIT`, `MSG_PEEK` ë“±) |

------

### âœ… ì „ì²´ íë¦„ ìš”ì•½

```
// ì„œë²„ ì¸¡
int server_fd = socket(AF_INET, SOCK_STREAM, 0);
bind(server_fd, ...);        // IP/PORT ë°”ì¸ë”©
listen(server_fd, 5);        // ì—°ê²° ëŒ€ê¸° ìƒíƒœ ì§„ì…
int client_fd = accept(server_fd, ...);  // ì ‘ì† ìˆ˜ë½
recv(client_fd, buf, ...);   // ë°ì´í„° ìˆ˜ì‹ 
send(client_fd, buf, ...);   // ë°ì´í„° ì†¡ì‹ 

// í´ë¼ì´ì–¸íŠ¸ ì¸¡
int client_fd = socket(AF_INET, SOCK_STREAM, 0);
connect(client_fd, ...);     // ì„œë²„ì— ì—°ê²°
send(client_fd, buf, ...);   // ë°ì´í„° ì†¡ì‹ 
recv(client_fd, buf, ...);   // ë°ì´í„° ìˆ˜ì‹ 
```

------

### âœ… ì˜¤ë¥˜ ì²˜ë¦¬ íŒ

| í•¨ìˆ˜        | ì‹¤íŒ¨ ì‹œ errno ì˜ˆì‹œ    | ì˜ë¯¸              |
| ----------- | --------------------- | ----------------- |
| `bind()`    | `EADDRINUSE`          | í¬íŠ¸ ì¤‘ë³µ         |
| `connect()` | `ECONNREFUSED`        | ì„œë²„ê°€ ì•ˆ ë–  ìˆìŒ |
| `send()`    | `EPIPE`, `ECONNRESET` | ì—°ê²° ì¢…ë£Œë¨       |
| `recv()`    | 0                     | ì—°ê²° ì¢…ë£Œë¨       |

------

### âœ… ê°„ë‹¨í•œ ì˜ˆì œ: TCP í´ë¼ì´ì–¸íŠ¸

```
int sock = socket(AF_INET, SOCK_STREAM, 0);
struct sockaddr_in serv_addr;
serv_addr.sin_family = AF_INET;
serv_addr.sin_port = htons(1234);
inet_pton(AF_INET, "127.0.0.1", &serv_addr.sin_addr);
connect(sock, (struct sockaddr*)&serv_addr, sizeof(serv_addr));
send(sock, "Hello", 5, 0);
recv(sock, buffer, 1024, 0);
close(sock);
```

## 2.4 ë„¤íŠ¸ì›Œí¬ ë””ë²„ê¹… ë„êµ¬: `netstat`, `ss`, `lsof`, `tcpdump`

### âœ… 1. `netstat` (Network Statistics)

#### ğŸ“Œ ê°œìš”

- ë¦¬ëˆ…ìŠ¤ ì „í†µì ì¸ ë„¤íŠ¸ì›Œí¬ ì •ë³´ ë„êµ¬ (ì§€ê¸ˆì€ `ss`ê°€ ëŒ€ì²´ ì¤‘)
- ì—´ë ¤ ìˆëŠ” **í¬íŠ¸, ì—°ê²° ìƒíƒœ, ë¼ìš°íŒ… í…Œì´ë¸”, ì¸í„°í˜ì´ìŠ¤ ì •ë³´** í™•ì¸ ê°€ëŠ¥

#### ğŸ“‹ ì‚¬ìš© ì˜ˆì‹œ

```
netstat -an             # ëª¨ë“  ì—°ê²° ë° í¬íŠ¸ ì •ë³´ (ìˆ«ì)
netstat -tulnp          # TCP/UDP ë¦¬ìŠ¤ë‹ í¬íŠ¸ + í”„ë¡œì„¸ìŠ¤ ì •ë³´
netstat -rn             # ë¼ìš°íŒ… í…Œì´ë¸” ì¶œë ¥
```

| ì˜µì…˜ | ì„¤ëª…                                |
| ---- | ----------------------------------- |
| `-a` | ëª¨ë“  ì—°ê²° (listening + established) |
| `-n` | ìˆ«ìë¡œ ì¶œë ¥ (DNS ì¡°íšŒ ìƒëµ)         |
| `-t` | TCP                                 |
| `-u` | UDP                                 |
| `-l` | Listening ìƒíƒœ                      |
| `-p` | ì†Œì¼“ ì‚¬ìš© ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ í‘œì‹œ        |
| `-r` | ë¼ìš°íŒ… í…Œì´ë¸”                       |

> ğŸ”’ ê¶Œí•œ ì—†ëŠ” ìœ ì €ëŠ” `-p` ì˜µì…˜ìœ¼ë¡œ í”„ë¡œì„¸ìŠ¤ ì •ë³´ í™•ì¸ ë¶ˆê°€

------

### âœ… 2. `ss` (Socket Statistics)

#### ğŸ“Œ ê°œìš”

- `netstat`ë³´ë‹¤ ë” ë¹ ë¥´ê³  ê°•ë ¥í•œ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸ ë„êµ¬
- **/proc/net** ê¸°ë°˜ìœ¼ë¡œ ì‹¤ì‹œê°„ ì†Œì¼“ ì •ë³´ ì¶œë ¥

#### ğŸ“‹ ì‚¬ìš© ì˜ˆì‹œ

```
ss -tuln                   # TCP/UDP listening í¬íŠ¸ í™•ì¸
ss -s                      # ì†Œì¼“ í†µê³„ ìš”ì•½
ss -p state established    # ì—°ê²° ì™„ë£Œëœ ì„¸ì…˜ê³¼ PID í™•ì¸
```

| ì˜µì…˜                | ì„¤ëª…                    |
| ------------------- | ----------------------- |
| `-t`                | TCP ì†Œì¼“                |
| `-u`                | UDP ì†Œì¼“                |
| `-l`                | Listening ì¤‘ì¸ ì†Œì¼“     |
| `-n`                | ìˆ«ì IP, í¬íŠ¸ ì¶œë ¥      |
| `-p`                | PID/í”„ë¡œì„¸ìŠ¤ ì •ë³´ í‘œì‹œ  |
| `-s`                | í†µê³„ ìš”ì•½               |
| `state established` | í˜„ì¬ ì—°ê²°ëœ ìƒíƒœë§Œ ì¶œë ¥ |

------

### âœ… 3. `lsof` (List Open Files)

#### ğŸ“Œ ê°œìš”

- **ì—´ë ¤ ìˆëŠ” íŒŒì¼/ì†Œì¼“/ë””ìŠ¤í¬/í¬íŠ¸ ë“± ëª¨ë“  ë¦¬ì†ŒìŠ¤** í™•ì¸ ê°€ëŠ¥
- íŠ¹íˆ í¬íŠ¸ì™€ í”„ë¡œì„¸ìŠ¤ ê´€ê³„ë¥¼ ì¶”ì í•  ë•Œ ë§¤ìš° ìœ ìš©

#### ğŸ“‹ ì‚¬ìš© ì˜ˆì‹œ

```
lsof -i :8080             # 8080 í¬íŠ¸ë¥¼ ì ìœ  ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤
lsof -i                  # ì „ì²´ ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸
lsof -iTCP -sTCP:LISTEN   # TCP ë¦¬ìŠ¤ë‹ í¬íŠ¸ë§Œ ë³´ê¸°
```

| ì˜µì…˜           | ì„¤ëª…                     |
| -------------- | ------------------------ |
| `-i`           | ë„¤íŠ¸ì›Œí¬ íŒŒì¼ (TCP, UDP) |
| `-sTCP:LISTEN` | ë¦¬ìŠ¤ë‹ ìƒíƒœë§Œ            |
| `:í¬íŠ¸ë²ˆí˜¸`    | íŠ¹ì • í¬íŠ¸ ê²€ìƒ‰           |
| `-nP`          | IP/í¬íŠ¸ ìˆ«ì ì¶œë ¥        |

> `kill -9 $(lsof -t -i :8080)`ë¡œ í¬íŠ¸ë¥¼ ì ìœ í•œ í”„ë¡œì„¸ìŠ¤ë¥¼ ì£½ì¼ ìˆ˜ë„ ìˆì–´

------

### âœ… 4. `tcpdump`

#### ğŸ“Œ ê°œìš”

- **ë¡œìš° ë ˆë²¨ íŒ¨í‚· ë¶„ì„ ë„êµ¬**
- ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ì—ì„œ ì‹¤ì œë¡œ ì˜¤ê°€ëŠ” íŒ¨í‚·ì„ **í—¤ë” ë‹¨ìœ„ë¡œ ìº¡ì²˜**

#### ğŸ“‹ ê¸°ë³¸ êµ¬ì¡°

```
tcpdump -i ì¸í„°í˜ì´ìŠ¤ [í•„í„°]
```

#### ğŸ“‹ ì˜ˆì‹œ

```
tcpdump -i lo               # ë¡œì»¬ ë£¨í”„ë°± ì¸í„°í˜ì´ìŠ¤ ê°ì‹œ
tcpdump -i eth0 port 8080  # 8080 í¬íŠ¸ë¡œ ì£¼ê³ ë°›ëŠ” íŒ¨í‚·ë§Œ
tcpdump -nn -X port 80     # ìˆ«ì ì¶œë ¥ + payload ë°”ì´íŠ¸ ë¤í”„
tcpdump -w dump.pcap       # íŒ¨í‚·ì„ pcap íŒŒì¼ë¡œ ì €ì¥
tcpdump -r dump.pcap       # ì €ì¥í•œ pcap íŒŒì¼ ë‹¤ì‹œ ë³´ê¸°
```

| ì˜µì…˜       | ì„¤ëª…                                                         |
| ---------- | ------------------------------------------------------------ |
| `-i`       | ê°ì‹œí•  ì¸í„°í˜ì´ìŠ¤ ì§€ì •                                       |
| `-nn`      | DNS, í¬íŠ¸ ì´ë¦„ í•´ì„ ìƒëµ                                     |
| `-X`       | íŒ¨í‚·ì˜ payloadê¹Œì§€ í—¥ì‚¬ + ASCIIë¡œ ì¶œë ¥                       |
| `-w`, `-r` | ì €ì¥ ë° ì½ê¸°                                                 |
| í•„í„° ì˜ˆì‹œ  | `port 80`, `tcp`, `udp`, `host 192.168.0.1`, `src`, `dst` ë“± |

> `wireshark`ê³¼ í•¨ê»˜ `.pcap` íŒŒì¼ì„ ë¶„ì„í•˜ë©´ GUI ê¸°ë°˜ ë¶„ì„ë„ ê°€ëŠ¥í•´

------

### ğŸ§ª ì‹¤ì „ í™œìš© íë¦„

| ë¬¸ì œ                            | ì‚¬ìš©í•  ë„êµ¬             | í™œìš© ì˜ˆ                   |
| ------------------------------- | ----------------------- | ------------------------- |
| íŠ¹ì • í¬íŠ¸ ëˆ„ê°€ ì“°ê³  ìˆëŠ”ì§€ í™•ì¸ | `lsof`, `ss`, `netstat` | `lsof -i :í¬íŠ¸`           |
| ì„œë²„ì— ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸ í™•ì¸   | `ss`, `netstat`         | `ss -t state established` |
| íŒ¨í‚·ì´ ì˜¤ê°€ëŠ”ì§€ ì‹¤ì‹œê°„ í™•ì¸     | `tcpdump`               | `tcpdump -i eth0 port 80` |
| ì‹œìŠ¤í…œ ì½œ ìˆ˜ì¤€ ì¶”ì              | `strace`, `lsof`        | `strace -p PID`           |

------

### âœ… ìš”ì•½ ì •ë¦¬

| ë„êµ¬      | ì£¼ìš” ê¸°ëŠ¥                                  |
| --------- | ------------------------------------------ |
| `netstat` | ì—°ê²° ìƒíƒœ, í¬íŠ¸, ë¼ìš°íŒ… ì •ë³´ í™•ì¸ (legacy) |
| `ss`      | ë¹ ë¥´ê³  ê°•ë ¥í•œ ì‹¤ì‹œê°„ ì†Œì¼“ ë¶„ì„             |
| `lsof`    | ì—´ë¦° íŒŒì¼/ì†Œì¼“ê³¼ í”„ë¡œì„¸ìŠ¤ ë§¤í•‘ ì¶”ì         |
| `tcpdump` | ë¡œìš° ë ˆë²¨ íŒ¨í‚· ë¶„ì„, í•„í„°ë§, ì €ì¥          |