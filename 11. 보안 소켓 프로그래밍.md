# 11. λ³΄μ• μ†μΌ“ ν”„λ΅κ·Έλλ°

## 11.1 TLS/SSL κΈ°μ΄ μ΄λ΅ 

### β… κ°μ”

TLS(Transport Layer Security)μ™€ SSL(Secure Sockets Layer)λ” **λ„¤νΈμ›ν¬ μ „μ†΅ κ³„μΈµ λ³΄μ•μ„ μ„ν• ν”„λ΅ν† μ½**μ΄λ‹¤. μ£Όλ΅ HTTPS, SMTPS, FTPS λ“±μ—μ„ μ‚¬μ©λλ©°, **κΈ°λ°€μ„±(Confidentiality)**, **λ¬΄κ²°μ„±(Integrity)**, **μΈμ¦(Authentication)**μ„ λ³΄μ¥ν•λ‹¤.

> SSLμ€ 3.0κΉμ§€ λ°ν‘λμ—κ³  μ΄ν›„ TLSλ΅ λ…μΉ­μ΄ λ³€κ²½λ¨ (μ‹¤μ λ΅λ” TLS 1.0 = SSL 3.1)

------

### β… TLSμ μ£Όμ” λ©μ 

| ν•­λ©   | μ„¤λ…                                          |
| ------ | --------------------------------------------- |
| κΈ°λ°€μ„± | μ•”νΈν™”λ¥Ό ν†µν•΄ μ¤‘κ°„μ(MITM) κ³µκ²© λ°©μ§€          |
| λ¬΄κ²°μ„± | λ©”μ‹μ§€ λ³€μ΅° λ°©μ§€λ¥Ό μ„ν• MAC λλ” HMAC μ‚¬μ©    |
| μΈμ¦   | κ³µκ°ν‚¤ κΈ°λ° μΈμ¦μ„ μ²΄κ³„ (CA κΈ°λ°)λ΅ μ‹ μ› ν™•μΈ |

------

### β… TLS/SSL ν”„λ΅ν† μ½ κµ¬μ„±

TLSλ” λ‹¤μκ³Ό κ°™μ€ **ν•μ„ ν”„λ΅ν† μ½**λ΅ κµ¬μ„±λλ‹¤:

1. **Handshake Protocol**
   - μΈμ¦μ„ κµν™ λ° ν‚¤ ν‘μƒ
2. **Record Protocol**
   - μ‹¤μ  μ‘μ© λ°μ΄ν„° μ•”νΈν™” λ° μ „μ†΅
3. **Change Cipher Spec Protocol**
   - μƒ μ•”νΈ μ•κ³ λ¦¬μ¦ μ μ© μ‹μ  ν†µμ§€
4. **Alert Protocol**
   - μ—λ¬λ‚ κ²½κ³  μƒν™© μ•λ¦Ό

------

### β… TLS Handshake κ³Όμ • (μ”μ•½ νλ¦„)

1. **ClientHello**
   - ν΄λΌμ΄μ–ΈνΈκ°€ μ‚¬μ©ν•  μ μλ” TLS λ²„μ „, μ•”νΈ μ•κ³ λ¦¬μ¦ λ©λ΅, λλ¤ λ°μ΄ν„° μ „μ†΅
2. **ServerHello**
   - μ„λ²„κ°€ TLS λ²„μ „κ³Ό μ•”νΈ μ•κ³ λ¦¬μ¦ μ„ νƒ, μΈμ¦μ„(Certificate) μ „λ‹¬
3. **Key Exchange**
   - RSA λλ” Diffie-Hellman λ°©μ‹μΌλ΅ λ€μΉ­ν‚¤λ¥Ό μ•μ „ν•κ² κµν™
4. **Session Key μƒμ„±**
   - μ–‘μΈ΅μ΄ κ³µν†µμ **λ€μΉ­ν‚¤**λ¥Ό λ§λ“¤μ–΄ μ΄ν›„ ν†µμ‹ μ— μ‚¬μ©
5. **Finished λ©”μ‹μ§€ κµν™**
   - μ•”νΈν™” ν†µμ‹  μ‹μ‘ μ „ λ§μ§€λ§‰ λ¬΄κ²°μ„± κ²€μ¦

------

### β… TLS vs SSL μ°¨μ΄μ 

| ν•­λ©      | SSL 3.0                 | TLS 1.0~1.3             |
| --------- | ----------------------- | ----------------------- |
| μ•μ „μ„±    | μ•λ ¤μ§„ μ·¨μ•½μ  μ΅΄μ¬      | μµμ‹  TLSλ” λ³΄μ•μ„± λ†’μ  |
| μ•κ³ λ¦¬μ¦  | RC4 λ“± μ·¨μ•½ν• μ•”νΈ μ‚¬μ© | AES, ChaCha20, HMAC λ“±  |
| μΈμ¦μ„    | X.509                   | λ™μΌ                    |
| μ§€μ› μ—¬λ¶€ | λ€λ¶€λ¶„ νκΈ°λ¨           | TLS 1.2/1.3λ§ μ‚¬μ© κ¶μ¥ |

------

### β… TLS 1.3 κ°μ„ μ 

| ν•­λ©                    | μ„¤λ…                                     |
| ----------------------- | ---------------------------------------- |
| ν•Έλ“μ…°μ΄ν¬ κ°„μ†ν™”       | μ™•λ³µ νμ κ°μ† (1-RTT)                   |
| μ•”νΈ μ¤μ„νΈ λ‹¨μν™”      | λ¶ν•„μ”ν• μ•κ³ λ¦¬μ¦ μ κ±°                   |
| Perfect Forward Secrecy | λ¨λ“  ν‚¤ κµν™μ— μ„μ‹ ν‚¤ μ‚¬μ© (e.g. ECDHE) |

------

### β… μΈμ¦μ„μ™€ κ³µκ°ν‚¤ μ•”νΈν™”

- μ„λ²„λ” **κ³µμΈ μΈμ¦κΈ°κ΄€(CA)**μ—μ„ λ°κΈ‰ν• **X.509 μΈμ¦μ„**λ¥Ό ν†µν•΄ μ‹ λΆ°λ¥Ό μ–»μ
- ν΄λΌμ΄μ–ΈνΈλ” μΈμ¦μ„μ— λ‚΄μ¥λ **κ³µκ°ν‚¤**λ΅ μ„λ²„μ μ„λ… λ“±μ„ κ²€μ¦ν•¨
- μ΄ν›„ λ€μΉ­ν‚¤λ¥Ό λ§λ“¤μ–΄ μ‹¤μ  λ°μ΄ν„° μ „μ†΅μ€ ν¨μ¨μ μΈ **λ€μΉ­ μ•”νΈν™”**λ΅ μν–‰

------

### β… μ‹¤μ „ μμ‹ (HTTPS)

1. λΈλΌμ°μ €κ°€ `https://example.com` μ”μ²­
2. μ„λ²„λ” TLS μΈμ¦μ„μ™€ Handshake μν–‰
3. μ„Έμ… ν‚¤ μƒμ„± β†’ λΈλΌμ°μ €μ™€ μ•”νΈν™”λ HTTP λ°μ΄ν„° μ†΅μμ‹ 

------

### β… μ£Όμ” μ‚¬μ© ν¬νΈ

| ν”„λ΅ν† μ½     | ν¬νΈ        | μ„¤λ…                     |
| ------------ | ----------- | ------------------------ |
| HTTPS        | 443         | μ›Ή λ³΄μ•                  |
| SMTPS        | 465         | λ©”μΌ λ³΄μ•                |
| FTPS         | 990         | νμΌ μ „μ†΅ λ³΄μ•           |
| TLS over TCP | μ„μμ ν¬νΈ | μ‘μ© κ³„μΈµ μ§μ ‘ μ—°λ™ κ°€λ¥ |

------

### β… μ •λ¦¬ μ”μ•½

- TLSλ” SSLμ ν›„μ† λ³΄μ• ν”„λ΅ν† μ½
- λ³΄μ•μ„±, μ„±λ¥, μ μ—°μ„±μ„ λ¨λ‘ κ³ λ ¤ν• κµ¬μ΅°
- μ‹¤μ  ν†µμ‹ μ€ **λ€μΉ­ν‚¤**λ΅ μν–‰ν•λ©°, ν‚¤ κµν™λ§ **κ³µκ°ν‚¤ κΈ°λ°**

## 11.2 OpenSSLμ„ μ΄μ©ν• C μ–Έμ–΄ κΈ°λ° SSL μ„λ²„/ν΄λΌμ΄μ–ΈνΈ κµ¬ν„

### β… OpenSSLμ΄λ€?

OpenSSLμ€ TLS/SSL ν”„λ΅ν† μ½μ„ μ§€μ›ν•λ” **μ¤ν”μ†μ¤ μ•”νΈν™” λΌμ΄λΈλ¬λ¦¬**λ‹¤.
 TLS ν•Έλ“μ…°μ΄ν¬, λ€μΉ­ μ•”νΈν™”, μΈμ¦μ„ μ²λ¦¬ λ“±μ„ ν¬ν•¨ν• μ „λ°©μ„ λ„¤νΈμ›ν¬ λ³΄μ• κΈ°λ¥μ„ μ κ³µν•λ‹¤.

------

### β… μ¤€λΉ„ μ‚¬ν•­

- Linux ν™κ²½ (Ubuntu κΈ°μ¤€)

- OpenSSL κ°λ° λΌμ΄λΈλ¬λ¦¬ μ„¤μΉ:

  ```
  sudo apt install libssl-dev
  ```

- μ»΄νμΌ μ‹ `-lssl -lcrypto` μµμ… ν•„μ”

------

### β… SSL μ„λ²„ μ½”λ“ μμ  (λ‹¨μΌ μ ‘μ†)

```
#include <openssl/ssl.h>
#include <openssl/err.h>
#include <netinet/in.h>
#include <unistd.h>
#include <string.h>

#define PORT 4433

int main() {
    SSL_library_init();
    SSL_load_error_strings();
    OpenSSL_add_ssl_algorithms();

    const SSL_METHOD* method = TLS_server_method();
    SSL_CTX* ctx = SSL_CTX_new(method);

    // μΈμ¦μ„μ™€ ν‚¤ λ΅λ“
    SSL_CTX_use_certificate_file(ctx, "server.crt", SSL_FILETYPE_PEM);
    SSL_CTX_use_PrivateKey_file(ctx, "server.key", SSL_FILETYPE_PEM);

    int sockfd = socket(AF_INET, SOCK_STREAM, 0);
    struct sockaddr_in addr = {0};
    addr.sin_family = AF_INET;
    addr.sin_port = htons(PORT);
    addr.sin_addr.s_addr = INADDR_ANY;
    bind(sockfd, (struct sockaddr*)&addr, sizeof(addr));
    listen(sockfd, 1);

    int client = accept(sockfd, NULL, NULL);
    SSL* ssl = SSL_new(ctx);
    SSL_set_fd(ssl, client);
    SSL_accept(ssl); // ν•Έλ“μ…°μ΄ν¬

    char buffer[1024] = {0};
    SSL_read(ssl, buffer, sizeof(buffer));
    SSL_write(ssl, "Hello Secure World!\n", 21);

    SSL_shutdown(ssl);
    SSL_free(ssl);
    close(client);
    close(sockfd);
    SSL_CTX_free(ctx);
    EVP_cleanup();
}
```

------

### β… SSL ν΄λΌμ΄μ–ΈνΈ μ½”λ“ μμ 

```
#include <openssl/ssl.h>
#include <openssl/err.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include <unistd.h>
#include <string.h>

#define PORT 4433

int main() {
    SSL_library_init();
    SSL_load_error_strings();
    OpenSSL_add_ssl_algorithms();

    const SSL_METHOD* method = TLS_client_method();
    SSL_CTX* ctx = SSL_CTX_new(method);

    int sockfd = socket(AF_INET, SOCK_STREAM, 0);
    struct sockaddr_in addr = {0};
    addr.sin_family = AF_INET;
    addr.sin_port = htons(PORT);
    inet_pton(AF_INET, "127.0.0.1", &addr.sin_addr);
    connect(sockfd, (struct sockaddr*)&addr, sizeof(addr));

    SSL* ssl = SSL_new(ctx);
    SSL_set_fd(ssl, sockfd);
    SSL_connect(ssl); // ν•Έλ“μ…°μ΄ν¬

    SSL_write(ssl, "GET /secure HTTP/1.1\r\n\r\n", 26);

    char buffer[1024] = {0};
    SSL_read(ssl, buffer, sizeof(buffer));
    printf("Received: %s\n", buffer);

    SSL_shutdown(ssl);
    SSL_free(ssl);
    close(sockfd);
    SSL_CTX_free(ctx);
    EVP_cleanup();
}
```

------

### β… μΈμ¦μ„ μƒμ„± (μμ²΄ μ„λ…μ© ν…μ¤νΈμ©)

```
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout server.key -out server.crt
```

------

### β… μ£Όμ” ν•¨μ μ„¤λ… μ”μ•½

| ν•¨μ                     | μ„¤λ…                          |
| ------------------------ | ----------------------------- |
| `SSL_library_init()`     | SSL ν•¨μ μ΄κΈ°ν™”               |
| `SSL_CTX_new()`          | SSL context μƒμ„±              |
| `SSL_new()`              | μ†μΌ“μ— λ€ν• SSL κ°μ²΄ μƒμ„±     |
| `SSL_set_fd()`           | μ†μΌ“κ³Ό SSL μ—°κ²°               |
| `SSL_accept()`           | μ„λ²„ μΈ΅ TLS ν•Έλ“μ…°μ΄ν¬ μν–‰   |
| `SSL_connect()`          | ν΄λΌμ΄μ–ΈνΈ μΈ΅ ν•Έλ“μ…°μ΄ν¬ μν–‰ |
| `SSL_read()/SSL_write()` | μ•”νΈν™”λ μ†΅μμ‹                |
| `SSL_shutdown()`         | SSL μ—°κ²° μΆ…λ£                 |

------

### π“ μ μ μ‚¬ν•­

- TLS μ—°κ²°μ€ ν•Έλ“μ…°μ΄ν¬ κ³Όμ •μ—μ„ μ¤λ μ‹κ°„μ΄ μ†μ”λ  μ μμΌλ©°, μ„λ²„ μΈμ¦μ„μ— λ”°λΌ `verify` μ μ°¨λ„ ν•„μ”ν•¨
- μ‹¤μ „μ—μ„λ” **μΈμ¦μ„ κ²€μ¦(`SSL_CTX_set_verify`)κ³Ό CA μ²΄μΈ λ“±λ΅**λ„ μν–‰ν•΄μ•Ό ν•¨

## 11.3 μΈμ¦μ„ λ°κΈ‰, ν‚¤ κµν™, μ•”νΈν™” μ²λ¦¬

TLS(Transport Layer Security)μ—μ„ μ•μ „ν• ν†µμ‹ μ„ λ³΄μ¥ν•κΈ° μ„ν•΄ ν•„μμ μΌλ΅ μν–‰λλ” μ„Έ κ°€μ§€ λ³΄μ• λ©”μ»¤λ‹μ¦μ€ λ‹¤μκ³Ό κ°™λ‹¤.

------

### β… 1. μΈμ¦μ„ λ°κΈ‰ (Certificate Issuance)

#### β–· μΈμ¦μ„λ€?

- X.509 ν•μ‹μ **κ³µκ°ν‚¤ + μΈμ¦ μ •λ³΄**λ΅ κµ¬μ„±λ νμΌ
- ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„ μΈμ¦μ„λ¥Ό ν†µν•΄ μ‹ λΆ°μ„±κ³Ό μ§„μ„λ¥Ό κ²€μ¦

#### β–· λ°κΈ‰ λ°©μ‹

1. **μμ²΄ μ„λ…(Self-Signed)**

   - ν…μ¤νΈ λ©μ  λλ” λ‚΄λ¶€ ν†µμ‹ μ— μ‚¬μ©
   - μ™Έλ¶€ CA(μΈμ¦κΈ°κ΄€)μ— μν•΄ μ‹ λΆ°λμ§€ μ•μ

   ```
   openssl req -x509 -nodes -newkey rsa:2048 \
     -keyout server.key -out server.crt -days 365
   ```

2. **CA μ„λ…(CA-Signed Certificate)**

   - μ •μ‹ μΈμ¦κΈ°κ΄€(CA)μΌλ΅λ¶€ν„° λ°κΈ‰
   - λΈλΌμ°μ €/OSμ— λ‚΄μ¥λ λ£¨νΈ μΈμ¦μ„λ΅ κ²€μ¦λ¨
   - μ μ°¨:
     - κ°μΈν‚¤ μƒμ„± β†’ CSR μƒμ„± β†’ CA μ μ¶ β†’ μΈμ¦μ„ μμ‹ 

   ```
   # CSR μƒμ„±
   openssl req -new -key server.key -out server.csr
   
   # μ΄ν›„ CSRμ„ CAμ— μ μ¶ν•΄ .crt νμΌ μλ Ή
   ```

------

### β… 2. ν‚¤ κµν™ (Key Exchange)

TLSμ—μ„λ” μ΄κΈ° ν†µμ‹  μ¤‘μ— **μ„Έμ… ν‚¤(session key)**λ¥Ό μ•μ „ν•κ² κµν™ν•΄μ•Ό ν•λ‹¤. μ΄λ¥Ό μ„ν•΄ λ‹¤μ λ‘ κ°€μ§€ λ°©μ‹μ„ μ‚¬μ©ν•λ‹¤.

#### β‘  RSA κΈ°λ° ν‚¤ κµν™ (κΈ°λ³Έμ )

- ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ κ³µκ°ν‚¤λ΅ μ„Έμ… ν‚¤λ¥Ό μ•”νΈν™”ν•΄ μ „μ†΅
- μ„λ²„λ” κ°μΈν‚¤λ΅ λ³µνΈν™”ν•μ—¬ μ„Έμ… ν‚¤ ν™•λ³΄
- λ‹¨μ : Perfect Forward Secrecy λ―Έμ§€μ›

#### β‘΅ Diffie-Hellman(Ephemeral DH ν¬ν•¨)

- **μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ ν‚¤ ν•©μ κ³Όμ •μ„ ν†µν•΄ μ„Έμ… ν‚¤ μƒμ„±**
- ECDHE(Elliptic Curve Diffie-Hellman Ephemeral) λ°©μ‹μ΄ ν„λ€ TLSμ—μ„ λ„λ¦¬ μ‚¬μ©λ¨
- μ¥μ : **Perfect Forward Secrecy(PFS)** μ§€μ›

------

### β… 3. μ•”νΈν™” μ²λ¦¬ (Encryption)

TLS μ„Έμ… ν‚¤ ν™•λ³΄ μ΄ν›„μ—λ” λ€μΉ­ ν‚¤ μ•”νΈν™”λ¥Ό ν†µν•΄ λ³Έκ²©μ μΈ λ°μ΄ν„° μ „μ†΅μ΄ μ΄λ£¨μ–΄μ§„λ‹¤.

| μ•”νΈν™” ν•­λ©           | μ„¤λ…                                                         |
| --------------------- | ------------------------------------------------------------ |
| **μ•”νΈν™” μ•κ³ λ¦¬μ¦**   | AES, ChaCha20 λ“±                                             |
| **λ©”μ‹μ§€ μΈμ¦ (MAC)** | HMAC-SHA256 λ“±                                               |
| **μ••μ¶• (μ„ νƒμ )**     | TLS 1.3μ—μ„λ” λΉ„ν™μ„±ν™” μ¶”μ„Έ                                  |
| **μ•”νΈ μ¤μ„νΈ**       | TLSμ μ•κ³ λ¦¬μ¦ κµ¬μ„± μ§‘ν•©. μ: `TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384` |

------

### π“‹ μΈμ¦μ„ + μ•”νΈν™” νλ¦„ μ”μ•½

1. ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„: `ClientHello` (μ§€μ› μ•”νΈ μ¤μ„νΈ ν¬ν•¨)
2. μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ: `ServerHello` + μΈμ¦μ„
3. ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„: ν‚¤ κµν™ λ©”μ‹μ§€ (ECDHE/RSA)
4. μ–‘μΈ΅ β†’ μ„Έμ… ν‚¤ μƒμ„± μ™„λ£ ν›„ μ•”νΈν™” μ‹μ‘
5. ν΄λΌμ΄μ–ΈνΈ β†” μ„λ²„: λ€μΉ­ μ•”νΈν™”λ μ‘λ‹µ μ£Όκ³ λ°›κΈ°

------

### π” μ‹¤λ¬΄ ν¬μΈνΈ

- μ„λ²„μ—μ„ `SSL_CTX_use_certificate_file()`κ³Ό `SSL_CTX_use_PrivateKey_file()`μ€ λ°λ“μ‹ μ§μ„ μ΄λ¤„μ•Ό ν•¨
- μ•”νΈν™” κ°•λ„λ” OpenSSLμ `openssl ciphers` λ…λ Ήμ–΄λ΅ ν™•μΈ κ°€λ¥
- TLS 1.3μ—μ„λ” RSA μΈμ¦ κΈ°λ° λ°©μ‹μ€ μ¤„κ³ , **ECDHE-ECDSA** κΈ°λ°μ΄ μΌλ°ν™”λ¨

## 11.4 μΈμ¦λ HTTPS μ„λ²„ κµ¬μ¶•

HTTPS μ„λ²„λ” HTTP μ„μ— **TLS(λλ” SSL)** κ³„μΈµμ„ μ¶”κ°€ν•΄ **μ•”νΈν™”λ μ•μ „ν• μ›Ή ν†µμ‹ **μ„ μ κ³µν•λ‹¤.
 μ΄ μ μ—μ„λ” C μ–Έμ–΄ λ° OpenSSLμ„ κΈ°λ°μΌλ΅ μ§μ ‘ μΈμ¦μ„λ¥Ό ν™μ©ν• HTTPS μ„λ²„λ¥Ό κµ¬ν„ν•κ³  κµ¬μ„±ν•λ” λ°©λ²•μ„ μ •λ¦¬ν•λ‹¤.

------

### β… 1. μ „μ²΄ νλ¦„ κ°μ”

```
ν΄λΌμ΄μ–ΈνΈ λΈλΌμ°μ €
        β‡… TLS Handshake
    μΈμ¦μ„ κ²€μ¦ + ν‚¤ κµν™
        β‡… HTTPS μ•”νΈν™” μ”μ²­/μ‘λ‹µ
        β‡… νμΌ μ „μ†΅ / API μ‘λ‹µ
HTTPS μ„λ²„ (OpenSSL + TCP Socket)
```

------

### β… 2. μ¤€λΉ„ μ‚¬ν•­

#### π“ OpenSSL μ„¤μΉ ν™•μΈ

```
openssl version
# OpenSSL 1.1.x or 3.x
```

#### π“ μ„λ²„ μΈμ¦μ„ λ° ν‚¤ μ¤€λΉ„

ν…μ¤νΈμ© Self-Signed μΈμ¦μ„ μƒμ„±:

```
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout server.key -out server.crt
```

------

### β… 3. OpenSSL κΈ°λ° HTTPS μ„λ²„ μ½”λ“ μμ 

#### π“‚ νμΌ κµ¬μ„±

- `https_server.c`
- `server.crt` (μΈμ¦μ„)
- `server.key` (κ°μΈν‚¤)

#### π“„ `https_server.c` μ£Όμ” κµ¬μ΅°

```
#include <openssl/ssl.h>
#include <openssl/err.h>
#include <netinet/in.h>
#include <unistd.h>
#include <string.h>

#define PORT 4433

void init_openssl() {
    SSL_load_error_strings();
    OpenSSL_add_ssl_algorithms();
}

SSL_CTX *create_context() {
    const SSL_METHOD *method = TLS_server_method(); // TLS 1.2/1.3
    SSL_CTX *ctx = SSL_CTX_new(method);
    if (!ctx) {
        perror("Unable to create SSL context");
        exit(EXIT_FAILURE);
    }
    return ctx;
}

void configure_context(SSL_CTX *ctx) {
    SSL_CTX_use_certificate_file(ctx, "server.crt", SSL_FILETYPE_PEM);
    SSL_CTX_use_PrivateKey_file(ctx, "server.key", SSL_FILETYPE_PEM);
}

int main() {
    int sockfd;
    struct sockaddr_in addr;

    init_openssl();
    SSL_CTX *ctx = create_context();
    configure_context(ctx);

    // TCP μ†μΌ“ μƒμ„±
    sockfd = socket(AF_INET, SOCK_STREAM, 0);
    addr.sin_family = AF_INET;
    addr.sin_port = htons(PORT);
    addr.sin_addr.s_addr = INADDR_ANY;

    bind(sockfd, (struct sockaddr*)&addr, sizeof(addr));
    listen(sockfd, 1);

    while (1) {
        struct sockaddr_in client;
        uint len = sizeof(client);
        int clientfd = accept(sockfd, (struct sockaddr*)&client, &len);

        SSL *ssl = SSL_new(ctx);
        SSL_set_fd(ssl, clientfd);

        if (SSL_accept(ssl) <= 0) {
            ERR_print_errors_fp(stderr);
        } else {
            const char *response =
                "HTTP/1.1 200 OK\r\n"
                "Content-Type: text/plain\r\n\r\n"
                "Hello over HTTPS!\n";
            SSL_write(ssl, response, strlen(response));
        }

        SSL_shutdown(ssl);
        SSL_free(ssl);
        close(clientfd);
    }

    close(sockfd);
    SSL_CTX_free(ctx);
    EVP_cleanup();
}
```

------

### β… 4. ν΄λΌμ΄μ–ΈνΈ μ ‘μ† ν…μ¤νΈ

λΈλΌμ°μ €μ—μ„λ” μμ²΄ μ„λ… μΈμ¦μ„λ¥Ό μ‹ λΆ°ν•μ§€ μ•μΌλ―€λ΅ **curl**μ„ μ‚¬μ©ν•λ” κ²ƒμ΄ μΌλ°μ μ΄λ‹¤.

```
curl -k https://localhost:4433
# -k: μΈμ¦μ„ κ²€μ¦ λ¬΄μ‹
```

------

### β… 5. μ‹¤λ¬΄μ—μ„μ HTTPS μ„λ²„ λ°°ν¬ ν¬μΈνΈ

| ν•­λ©          | μ„¤λ…                                                         |
| ------------- | ------------------------------------------------------------ |
| μΈμ¦μ„ μ ν¨μ„± | Letβ€™s Encrypt, GlobalSign λ“±μ CA μΈμ¦μ„ μ‚¬μ©                |
| ν¬νΈ ν¬μ›λ”©   | λ¦¬λ…μ¤μ—μ„ 443 β†’ μ‚¬μ©μ ν”„λ΅μ„Έμ¤λ΅ μ „λ‹¬ μ‹ `iptables` μ‚¬μ© κ°€λ¥ |
| μ„±λ¥          | OpenSSL + `epoll` λλ” `libevent` κµ¬μ΅°λ΅ κ³ λ„ν™” κ°€λ¥         |
| λ³΄μ•          | TLS 1.2 μ΄μƒλ§ ν—μ©, HTTP Strict Transport Security(HSTS) μ„¤μ • ν•„μ” |

------

### β… μ”μ•½

- HTTPS μ„λ²„λ” TCP + TLS + HTTP κ³„μΈµμΌλ΅ κµ¬μ„±λ¨
- OpenSSL APIλ¥Ό ν†µν•΄ Cμ—μ„λ„ TLS κΈ°λ° μ„λ²„ κµ¬ν„μ΄ κ°€λ¥
- μΈμ¦μ„λ” λ°λ“μ‹ TLS ν•Έλ“μ…°μ΄ν¬μ—μ„ μ‚¬μ©λλ©°, μ‹ λΆ° κΈ°λ° ν†µμ‹  λ³΄μ¥